

    <h2>Backlog for <%= @node.name %> - <%= link_to "Back to Node", @node %></h2> 


<div class="table-responsive">
    <table id="backlog" class="table table-striped table-hover">
      <thead>
        <th>Feature</th>
        <th>Specification</th>
        <th>Delivery</th>
        <th>Current Dependencies</th>
        <th>Open Issues</th>
        <th>Priority</th>
        <th>Added</th>
      </thead>
      <% @terminalNodes.each_with_index do |child, i|  %>
        <tr data-item-id=<%= "#{child.id}" %> data-item-position=<%= child.get_row_order_position %> <% if child.status %>class="success"<% end %>  >
          <% if child.nodeType.feature or child.nodeType.feature_organizer %>
            <td><%= link_to child.name, child %></td>
            <td></td>
          <% else %>
            <td><%= link_to child.parent.name, child.parent %></td>
            <td><%= link_to child.name, child %></td>
          <% end %>
          <td>
            <% if child.get_next_delivery != nil %>
              <%= child.get_next_delivery %>
            <% else %>
              <%= link_to 'Add Delivery Date', new_delivery_date_path(child) %>
            <% end %>
          </td>
          <td>
              <%= child.dependencies.count %>
          </td>
          <td></td>
          <td><span class="priority"><%= i+1 %></span></td>
          <td><%= child.created_at.strftime('%m/%d/%Y')%></td>
        </tr>
      <% end %>

    </table>
</div>


<script type="text/javascript">
/*
 * Jquery Multiselect插件 中文叫列表多选插件
 * 使用例子:
 * $('table').multiSelect({
 *  actcls: 'active',
 *  selector: 'tbody tr',
 *  callback: false
 * });
 * Checkout http://www.jqueryscript.net/table/jQuery-Plugin-To-Select-Multiple-Rows-In-A-Table-multiselect.html
 */
(function ($) {
    $.fn.multiSelect = function (options) {
        $.fn.multiSelect.init($(this), options);
    };

    $.extend($.fn.multiSelect, {
        defaults: {
            actcls: 'info', //选中样式
            selector: 'tbody tr', //选择的行元素
            except: ['tbody'], //选中后不去除多选效果的元素队列
            statics: ['.static'], //被排除行元素条件
            callback: false //选中回调
        },
        first: null, //按shift时，用于记住第一个点击的item
        last: null, //最后点击的item
        init: function (scope, options) {
            this.scope = scope;
            this.options = $.extend({}, this.defaults, options);
            this.initEvent();
        },
        checkStatics: function (dom) {
            for (var i in this.options.statics) {
                if (dom.is(this.options.statics[i])) {
                    return true;
                }
            }
        },
        initEvent: function () {
            var self = this,
                scope = self.scope,
                options = self.options,
                callback = options.callback,
                actcls = options.actcls;

            scope.on('click.mSelect', options.selector, function (e) {
                if (!e.shiftKey && self.checkStatics($(this))) {
                    return;
                }

                if ($(this).hasClass(actcls)) {
                    $(this).removeClass(actcls);
                } else {
                    $(this).addClass(actcls);
                }

                if (e.shiftKey && self.last) {
                    if (!self.first) {
                        self.first = self.last;
                    }
                    var start = self.first.index();
                    var end = $(this).index();
                    if (start > end) {
                        var temp = start;
                        start = end;
                        end = temp;
                    }
                    $(options.selector, scope).removeClass(actcls).slice(start, end + 1).each(function () {
                        if (!self.checkStatics($(this))) {
                            $(this).addClass(actcls);
                        }
                    });
                    window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
                } else if (!e.ctrlKey && !e.metaKey) {
                    $(this).siblings().removeClass(actcls);
                }
                self.last = $(this);
                $.isFunction(callback) && callback($(options.selector + '.' + actcls, scope));
            });

            /**
             * 点击其他处去除选中状态
             */
            $(document).on('click.mSelect', function (e) {
                for (var i in options.except) {
                    var except = options.except[i];
                    if ($(e.target).is(except) || $(e.target).parents(except).size()) {
                        return;
                    }
                }
                scope.find(options.selector).each(function () {
                    if (!self.checkStatics($(this))) {
                        $(this).removeClass(actcls);
                    }
                });
                $.isFunction(callback) && callback($(options.selector + '.' + actcls, scope));
            });

            /**
             * Ctrl+A全选
             */
            $(document).on('keydown.mSelect', function (e) {
                if ((e.keyCode == 65) && (e.metaKey || e.ctrlKey)) {
                    $(options.selector, scope).each(function () {
                        if (!self.checkStatics($(this))) {
                            $(this).addClass(actcls);
                        }
                    });
                    $.isFunction(callback) && callback($(options.selector + '.' + actcls, scope));
                    e.preventDefault();
                    return false;
                }
            });

            /**
             * 清楚shift按住的状态
             */
            $(document).on('keyup.mSelect', function (e) {
                if (e.keyCode == 16) {
                    self.first = null;
                }
            });
        }
    });
})(jQuery);
</script>

  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<script type="text/javascript">
  $(function () {
    $('#backlog').multiSelect();
  })


$(document).ready(function() {     
  //Helper function to keep table row from collapsing when being sorted     
  var fixHelperModified = function(e, tr) {         
    var $originals = tr.children();         
    var $helper = tr.clone();         
    $helper.children().each(function(index)         
      {           
        $(this).width($originals.eq(index).width())         
      }
    );         
    return $helper;     
  };     

  //Make backlog table sortable     
  $("#backlog tbody").multisortable({         
    helper: fixHelperModified,         
    stop: function(event,ui) {renumber_table('#backlog')}     
  }).disableSelection();     

}); 

//Renumber table rows 
function renumber_table(tableID) {     
  $(tableID + " tr").each(function() {         
    count = $(this).parent().children().index($(this)) + 1;         
    $(this).find('.priority').html(count); 
  }); 
}
</script>


    <script type="text/javascript">
      jQuery(function($){
        $('ul.sortable').multisortable();
        $('ul#list1').sortable('option', 'connectWith', 'ul#list2');
        $('ul#list2').sortable('option', 'connectWith', 'ul#list1');
      });
    </script>
    
 